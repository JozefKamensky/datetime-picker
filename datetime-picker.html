<link rel="import" href="../polymer/polymer.html">

<link rel="import" href="../datetime-input/datetime-input.html">
<link rel="import" href="datetime-polyfill-picker-mixin.html">
<link rel="import" href="time-element.html">
<link rel="import" href="calendar-element.html">

<script>
  /**
   * Mixin for datetime-picker
   *
   *  @appliesMixin DatetimeMixin
   *  @appliesMixin FormElementMixin
   *  @appliesMixin CalendarElementPattern
   *  @appliesMixin TimeElementPattern
   *  @appliesMixin SwitchContainerMixin
   *  @appliesMixin DatetimePolyfillPickerMixin
   *
   * @mixinFunction
   * @polymer
   *
   * @param {Object} superClass class to extend
   * @return {Object} extended class
   */
  const DatetimePickerPattern = superClass => class extends DatetimePolyfillPickerMixin(TimeElementPattern(CalendarElementPattern(SwitchContainerMixin(FormElementMixin(DatetimeMixin(superClass)))))) { // eslint-disable-line no-unused-vars, no-undef
    /**
     * custom style content
     * @type {string}
     */
    static get customStyleContent() {
      return `
        ${super.customStyleContent || ''}
        .lower {
          position: relative;
          left: 0; right: 0;
        }
        .lower > .container {
          display: inline-flex;
          flex-flow: row wrap;
          position: relative;
          width: 100%;
          border-radius: inherit;
          /* IE flex-wrap hack */
          /* position: absolute;
          top: auto; left: 0; right: 0; bottom: 0;
          transform: translateY(100%);
          box-shadow: inherit; */
        }
        .container > * {
          border-radius: 0 !important;
          box-shadow: none !important;
          padding: 0 !important;
          flex: 1 0 auto;
        }
      `;
    }

    static get pickerTemplate() {
      return `
        <div id="picker" class="dropdown" horizontal$="[[__partsHidden.day]]">
          ${this.calendarTemplate}
          <div class="lower">
            <div class="container">
              ${this.timeTemplate}
              <div id="buttons">
                ${this.buttonTemplate}
              </div>
            </div>
          </div>
        </div>
      `;
    }

    static get properties() {
      return {
        /**
         * Clamp datetime to a property
         * possible values: 'month', 'day', 'hours', 'minutes', 'seconds', 'milliseconds' or ''
         */
        clamp: {
          type: String,
          value: 'milliseconds'
        }
      }
    }

    _onDblClickDay(date) {
      super._onDblClickDay(date);
      this.confirm();
      this.close();
    }

    renderCalendar(year, month, day) {
      if (this._hasNative && this.native) {
        return;
      }
      super.renderCalendar(year, month, day, this.confirmedDate);
    }

    open() {
      if (super.open) {
        super.open();
      }
      this.renderCalendar(this.year, this.month, this.day, this.confirmedDate);
    }

  }
</script>

<dom-module id="datetime-picker">
  <script>
    /**
     *  `<datetime-picker>` is a picker for date and time for **[Polymer](https://github.com/Polymer/polymer)** that can use the **native** input, too. If the **native** picker is choosen and is not supported, this element uses the **polyfill** datetime-picker. The `<calendar-element>` and the `<time-element>` will come in place if the native picker is not available or is not explicitly wanted. A range picker is provided by combining the `min`- and `max`-attributes.
     *
     *  ```html
     *    <datetime-picker value="{{value}}"></datetime-picker>
     *  ```
     *
     *  A use case could be for example, if you want on mobile devices use the `native picker` and on desktop devices this polyfill.
     *
     *  ```html
     *    <datetime-picker native="[[isMobile]]"></datetime-picker>
     *    ...
     *      isMobile() {
     *        const ua = window.navigator.userAgent;
     *        return (/[mM]obi/i.test(ua) || /[tT]ablet/i.test(ua) || /[aA]ndroid/i.test(ua));
     *      }
     *    ...
     *  ```
     *
     *  If you need an **overlay** then use `overlay-datetime-picker`, that creates the element in an `overlay-element`, that extends *IronOverlayBehavior* and will create some of its attribute-bindings.
     *
     * Custom property | Description | Default
     * ----------------|-------------|----------
     * `--input-color` | Text-color of the element | `#dadada`
     * `--input-background` | Text-color of the element | `#2b2b2b`
     * `--input-focus-color` | Color of the focussed or hovered inputs and icons | `#f5f5f5`
     * `--input-focus-background` | Background of the focussed or hovered inputs and icons | `--primary-color, #394FE8`
     * `--input-style` | Mixin applied to the inputs | { padding: 0.25em; border-radius: 0.25em; text-align: center; transition: background 250ms cubic-bezier(0.6, 1, 0.2, 1);}`
     * `--input-focus` | Mixin applied to the focussed or hovered inputs | { color: var(--input-focus-color); background: var(--input-focus-background); }`
     * `--input-icon` | Mixin applied to the icons | `{ border-radius: 0.25em; padding: 0.5em; height: 1em; width: 1em; background: transparent; transition: background 150ms cubic-bezier(0.6, 1, 0.2, 1); }`
     * `--input-picker` | Mixin applied to the picker | `{box-shadow: 0 3px 4px 0 rgba(0, 0, 0, 0.14), 0 1px 8px 0 rgba(0, 0, 0, 0.12), 0 3px 3px -2px rgba(0, 0, 0, 0.4); border-radius: 0.25em;}`
     * `--input-picker-padding` | Padding of the picker | `4px`
     * `--input-selection-color` | Text-color of selected texts | `var(--input-focus-color)`
     * `--input-selection-background` | Background of selected texts | `rgba(255,255,255,0.1)`
     * `--calendar-element` | Mixin applied to the calender | `{}`
     * `--calendar-cell` | Mixin applied to the date cells | `{}`
     * `--calendar-cell-hovered` | Mixin applied to hovered date cells | `{}`
     * `--calendar-cell-size` | width of a date cell | `2.25em`
     * `--time-element` | Mixin applied to the time-element | `{}`
     *
     *  @customElement
     *  @polymer
     *
     *  @appliesMixin DatetimePickerPattern
     *
     *  @demo demo/index.html
     *  @demo demo/datetime-picker.html datetime elements
     *  @demo demo/form.html in a form
     *  @demo demo/music-album.html music album demo
     **/
    class DatetimePicker extends DatetimePickerPattern(Polymer.Element) { // eslint-disable-line no-undef

      static get is() {
        return 'datetime-picker';
      }

      get _hasNative() {
        return DatetimePicker._hasNative;
      }

    }

    window.customElements.define(DatetimePicker.is, DatetimePicker);
  </script>
</dom-module>
